(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{171:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return i(4829)}])},4829:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return m}});var a=i(5893),n=i(1163),r=i(7294),l=i(2237);let s=e=>e*Math.PI/180,u=(e,t)=>{let i=(t-e.createdAt)/1e3,a=300*i*Math.cos(s(e.direction)),n=300*i*Math.sin(s(e.direction)),r=e.createdPosition.x+a,l=e.createdPosition.y+n;return[r,l]},o=e=>{let{bullet:t,currentTime:i}=e,[n,r]=u(t,i);return(0,a.jsx)(l.Cd,{x:n,y:r,radius:5,fill:"red"})};var d=i(1290);let c=()=>{let e=(0,n.useRouter)(),[t,i]=(0,r.useState)(0);return(0,r.useEffect)(()=>{let t=async()=>{let t=await d.x.game.config.$get();null!==t&&i(t),0===t&&e.push("/game/config")};t()},[e]),(0,a.jsx)(a.Fragment,{children:[...Array(t)].map((t,i)=>(0,a.jsx)("button",{onClick:()=>e.push({query:{display:i}}),children:i},i))})};var y=i(1733),h=i(4420),p=i.n(h);let x=()=>{let e=(0,n.useRouter)(),t=void 0===e.query.display?null:Number(e.query.display);if(null===t)return(0,a.jsx)(c,{});let i=()=>{let[e,i]=(0,r.useState)([]),[n,s]=(0,r.useState)([]),[c,h]=(0,r.useState)([]),[x,m]=(0,r.useState)([]),[f,w]=(0,r.useState)(Date.now()),[g]=p()(y.D.images.spaceship_png),[j]=p()(y.D.images.ufo_jpg),_=async e=>{let t=await d.x.player.$get({query:{display:e}});null!==t&&i(t)},b=async e=>{let t=await d.x.enemy.$get({query:{display:e}});null!==t&&s(t)},P=async e=>{let t=await d.x.bullet.$get({query:{display:e}});null!==t&&(h(t.playerS),m(t.enemyS))},E=async t=>{let i=e.find(e=>e.id===t);i&&await d.x.player.status.$post({body:{player:{...i,health:i.health-1}}})},I=async()=>{let e=[];for(let t of n){let i=c.find(e=>{let i=u(e,f),a=Math.pow(t.createdPosition.x-i[0],2)+Math.pow(t.createdPosition.y-i[1],2);return a<2500});i&&i.playerId?(await d.x.enemy.$delete({body:{enemyId:t.id,userId:i.playerId}}),await d.x.bullet.$delete({body:{bulletId:i.id}})):e.push(t)}},S=async()=>{let t=[];for(let i of n){let a=e.find(e=>{let t=Math.pow(i.createdPosition.x-e.position.x,2)+Math.pow(i.createdPosition.y-e.position.y,2);return t<2500});a?(await d.x.enemy.$delete({body:{enemyId:i.id,userId:a.id}}),E(a.id)):t.push(i)}};return(0,r.useEffect)(()=>{let e=requestAnimationFrame(()=>{_(t),b(t),P(t),I(),S(),w(Date.now())});return()=>cancelAnimationFrame(e)}),(0,a.jsx)("div",{children:(0,a.jsxs)(l.Hf,{width:1920,height:1080,children:[(0,a.jsx)(l.mh,{children:c.map(e=>(0,a.jsx)(o,{bullet:e,currentTime:f},e.id))}),(0,a.jsx)(l.mh,{children:e.map(e=>(0,a.jsx)(l.Ee,{image:g,width:100,height:100,rotation:"red"===e.team?90:-90,x:e.position.x+50,y:e.position.y-50},e.id))}),(0,a.jsx)(l.mh,{children:n.map(e=>(0,a.jsx)(l.Ee,{image:j,width:80,height:80,x:e.createdPosition.x,y:e.createdPosition.y},e.id))})]})})};return(0,a.jsx)(i,{})};var m=x}},function(e){e.O(0,[289,774,888,179],function(){return e(e.s=171)}),_N_E=e.O()}]);