(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{171:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return i(4829)}])},4829:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return f}});var n=i(5893),a=i(1163),s=i(7294),r=i(2237);let l=e=>e*Math.PI/180,o=(e,t)=>{let i=(t-e.createdAt)/1e3,n=300*i*Math.cos(l(e.direction)),a=300*i*Math.sin(l(e.direction)),s=e.createdPosition.x+n,r=e.createdPosition.y+a;return[s,r]},u=e=>{let{bullet:t,currentTime:i}=e,[a,s]=o(t,i);return(0,n.jsx)(r.Cd,{x:a,y:s,radius:5,fill:"red"})};var d=i(1290),c=i(6850),y=i.n(c);let h=()=>{let e=(0,a.useRouter)(),[t,i]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let t=async()=>{let t=await d.x.game.config.$get();null!==t&&i(t),0===t&&e.push("/game/config")};t()},[e]),(0,n.jsxs)("div",{className:y().container,children:[(0,n.jsxs)("div",{className:y().title,children:[(0,n.jsx)("h1",{children:"Gradius"}),(0,n.jsx)("h2",{children:"Config"})]}),(0,n.jsx)("div",{className:y().buttons,children:[...Array(t)].map((t,i)=>(0,n.jsx)("button",{className:y().button,onClick:()=>e.push({query:{display:i}}),children:i},i))}),(0,n.jsx)("p",{className:y().text,children:"画面を選択してください"})]})};var x=i(1733),p=i(4420),_=i.n(p);let m=()=>{let e=(0,a.useRouter)(),t=void 0===e.query.display?null:Number(e.query.display);if(null===t)return(0,n.jsx)(h,{});let i=()=>{let[e,i]=(0,s.useState)([]),[a,l]=(0,s.useState)([]),[c,y]=(0,s.useState)([]),[h,p]=(0,s.useState)([]),[m,f]=(0,s.useState)(Date.now()),[b]=_()(x.D.images.spaceship_png),[g]=_()(x.D.images.ufo_jpg),[w]=_()(x.D.images.ufo_2_PNG),[j]=_()(x.D.images.ufo_3_PNG),N=async e=>{let t=await d.x.player.$get({query:{display:e}});null!==t&&i(t)},P=async e=>{let t=await d.x.enemy.$get({query:{display:e}});null!==t&&l(t)},v=async e=>{let t=await d.x.bullet.$get({query:{display:e}});null!==t&&(y(t.players),p(t.enemies))},E=async()=>{let e=[];for(let t of a){let i=c.find(e=>{let i=o(e,m),n=Math.pow(t.createdPosition.x-i[0],2)+Math.pow(t.createdPosition.y-i[1],2);return n<2500});i&&i.playerId?(await d.x.enemy.$delete({body:{enemyId:t.id,userId:i.playerId}}),await d.x.bullet.$delete({body:{bulletId:i.id}})):e.push(t)}},q=async()=>{let t=[];for(let i of a){let n=e.find(e=>{let t=Math.pow(i.createdPosition.x-e.position.x,2)+Math.pow(i.createdPosition.y-e.position.y,2);return t<2500});n?d.x.game.$post({body:{player:n,enemy:i}}):t.push(i)}};return(0,s.useEffect)(()=>{let e=requestAnimationFrame(()=>{N(t),P(t),v(t),E(),q(),f(Date.now())});return()=>cancelAnimationFrame(e)}),(0,n.jsx)("div",{children:(0,n.jsxs)(r.Hf,{width:1920,height:1080,children:[(0,n.jsx)(r.mh,{children:c.map(e=>(0,n.jsx)(u,{bullet:e,currentTime:m},e.id))}),(0,n.jsx)(r.mh,{children:e.map(e=>(0,n.jsx)(r.Ee,{image:b,width:100,height:100,rotation:"red"===e.team?90:-90,x:e.position.x+50,y:e.position.y-50},e.id))}),(0,n.jsx)(r.mh,{children:a.map(e=>(0,n.jsx)(r.Ee,{image:1===e.type?g:2===e.type?w:j,width:80,height:80,x:e.createdPosition.x,y:e.createdPosition.y},e.id))})]})})};return(0,n.jsx)(i,{})};var f=m},6850:function(e){e.exports={container:"Lobby_container__Z__4u",button:"Lobby_button__HHfXL",buttons:"Lobby_buttons__F_DSz",title:"Lobby_title__Twjsl",text:"Lobby_text__csIbQ"}}},function(e){e.O(0,[289,774,888,179],function(){return e(e.s=171)}),_N_E=e.O()}]);