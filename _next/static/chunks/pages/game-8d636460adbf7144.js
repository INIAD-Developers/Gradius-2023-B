(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{171:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return n(7362)}])},7362:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var i=n(5893),r=n(1163),a=n(7294),s=n(2237);let o=(e,t)=>{let n=(t-e.createdAt)/1e3,i=300*n*e.direction.x,r=300*n*e.direction.y,a=e.createdPosition.x+i,s=e.createdPosition.y+r;return[a,s]},l=e=>{let{bullet:t,currentTime:n}=e,[r,a]=o(t,n);return(0,i.jsx)(s.Cd,{x:r,y:a,radius:5,fill:"red"})};var u=n(185),c=n.n(u),d=n(1733),x=n(4420),h=n.n(x);let y=e=>{let{enemies:t}=e,n=(0,a.useRef)([]),[r]=h()(d.D.images.ufo_jpg),[o]=h()(d.D.images.ufo_2_PNG),[l]=h()(d.D.images.ufo_3_PNG);return(0,a.useEffect)(()=>{var e,t;let i=new(c()).Animation(e=>{n.current.forEach(t=>{if(t.current){var n;let i=Math.floor(((null!==(n=null==e?void 0:e.time)&&void 0!==n?n:0)/10+t.current.x())*Math.PI)/100;t.current.offset({x:5*Math.cos(i),y:5*Math.sin(i)})}})},null===(e=n.current[0])||void 0===e?void 0:null===(t=e.current)||void 0===t?void 0:t.getLayer());return i.start(),()=>{i.stop()}},[]),(0,i.jsx)(i.Fragment,{children:t.map((e,t)=>(n.current[t]=(0,a.createRef)(),(0,i.jsx)(s.Ee,{image:[r,o,l][e.type-1],width:80,height:80,x:e.createdPosition.x-40,y:e.createdPosition.y-40,ref:n.current[t]},e.id)))})};var f=n(1290),m=n(6850),p=n.n(m);let _=()=>{let e=(0,r.useRouter)(),[t,n]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let t=async()=>{let t=await f.x.game.config.$get();null!==t&&n(t),0===t&&e.push("/game/config")};t()},[e]),(0,i.jsxs)("div",{className:p().container,children:[(0,i.jsxs)("div",{className:p().title,children:[(0,i.jsx)("h1",{children:"Gradius"}),(0,i.jsx)("h2",{children:"Config"})]}),(0,i.jsx)("div",{className:p().buttons,children:[...Array(t)].map((t,n)=>(0,i.jsx)("button",{className:p().button,onClick:()=>e.push({query:{display:n}}),children:n},n))}),(0,i.jsx)("p",{className:p().text,children:"画面を選択してください"})]})},w=e=>{let{player:t}=e,[n]=h()(d.D.images.spaceship_png);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Ee,{image:n,width:100,height:100,rotation:"red"===t.team?90:-90,x:t.position.x+50,y:t.position.y-50},t.id),(0,i.jsx)(s.xv,{text:t.name,x:t.position.x-10,y:t.position.y+60,fontSize:24,fill:"black",align:"center"})]})};var b=n(201),g=n.n(b);let j=()=>{let e=(0,r.useRouter)(),t=void 0===e.query.display?null:Number(e.query.display);if(null===t)return(0,i.jsx)(_,{});let n=()=>{let[e,n]=(0,a.useState)([]),[r,u]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(Date.now()),[_,b]=(0,a.useState)(0),[j,v]=(0,a.useState)(0),E=async e=>{let t=await f.x.player.$get({query:{display:e}});null!==t&&n(t)},N=async e=>{let t=await f.x.enemy.$get({query:{display:e}});null!==t&&u(t)},P=async e=>{let t=await f.x.bullet.$get({query:{display:e}});null!==t&&(d(t.players),h(t.enemies))},S=async()=>{let e=[];for(let t of r){let n=c.find(e=>{let n=o(e,m),i=Math.pow(t.createdPosition.x-n[0],2)+Math.pow(t.createdPosition.y-n[1],2);return i<2500});n&&n.playerId?(await f.x.enemy.$delete({body:{enemyId:t.id,userId:n.playerId}}),await f.x.bullet.$delete({body:{bulletId:n.id}})):e.push(t)}},L=async()=>{let t=[];for(let n of r){let i=e.find(e=>{let t=Math.pow(n.createdPosition.x-e.position.x,2)+Math.pow(n.createdPosition.y-e.position.y,2);return t<2500});i?f.x.game.$post({body:{player:i,enemy:n}}):t.push(n)}};return(0,a.useEffect)(()=>{let e=requestAnimationFrame(()=>{E(t),N(t),P(t),S(),L(),p(Date.now())});return()=>cancelAnimationFrame(e)}),(0,a.useEffect)(()=>{let e=()=>{b(window.innerWidth),v(window.innerHeight)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,i.jsx)("div",{className:g()["canvas-container"],children:(0,i.jsxs)(s.Hf,{width:1920,height:1080,style:{transform:"\n            scale( ".concat(_/1920,", ").concat(j/1080," )\n            translate(").concat((_-1920)/2,"px, ").concat((j-1080)/2,"px)")},children:[(0,i.jsx)(s.mh,{children:c.map(e=>(0,i.jsx)(l,{bullet:e,currentTime:m},e.id))}),(0,i.jsx)(s.mh,{children:x.map(e=>(0,i.jsx)(l,{bullet:e,currentTime:m},e.id))}),(0,i.jsx)(s.mh,{children:e.map(e=>(0,i.jsx)(w,{player:e},e.id))}),(0,i.jsx)(s.mh,{children:(0,i.jsx)(y,{enemies:r})})]})})};return(0,i.jsx)(n,{})};var v=j},6850:function(e){e.exports={container:"Lobby_container__Z__4u",button:"Lobby_button__HHfXL",buttons:"Lobby_buttons__F_DSz",title:"Lobby_title__Twjsl",text:"Lobby_text__csIbQ"}},201:function(e){e.exports={"canvas-container":"game_canvas-container__wJcyG"}}},function(e){e.O(0,[289,774,888,179],function(){return e(e.s=171)}),_N_E=e.O()}]);